(()=>{"use strict";const t={init:function(t){this.ref=t},create:function(t,e,a){return this.ref.push({title:t,body:e,createdAt:moment(a).toISOString()})}},e={init:function(t,e){this.auth=t,this.endpoint=e},publish:function(t,e){var a=this.endpoint,i=new FormData;return i.append("key",t),i.append("title",e.title),i.append("body",e.body),i.append("createdAt",new Date(e.createdAt).toISOString()),this.auth.currentUser.getToken(!0).then((function(t){return i.append("idToken",t),fetch(a,{method:"POST",mode:"cors",body:i}).then((function(t){if(!t.ok)throw new Error("Failed to publish")}))}))}};var a="AuthService:user";const i={init:function(t){this.auth=t},getUser:function(){return localStorage.getItem(a)},login:function(t,e){return this.auth.signInWithEmailAndPassword(t,e).then((function(t){localStorage.setItem(a,t.email)}))},logout:function(){this.auth.signOut().then((function(){localStorage.removeItem(a)}))}};var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"modal",attrs:{id:"logindialog"}},[a("form",{attrs:{action:"#",method:"POST"},on:{submit:function(e){return e.preventDefault(),t.$emit("submit",e.target.elements.email.value,e.target.elements.password.value)}}},[t._m(0),t._v(" "),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn-flat",attrs:{type:"submit"}},[t._v("Login")]),t._v(" "),a("button",{staticClass:"btn-flat",on:{click:function(e){return t.history.back()}}},[t._v("Cancel")])])])])};function n(t,e,a,i,s,n,o,r){var l,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=a,c._compiled=!0),i&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),o?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=l):s&&(l=r?function(){s.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:s),l)if(c.functional){c._injectStyles=l;var u=c.render;c.render=function(t,e){return l.call(e),u(t,e)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:t,options:c}}s._withStripped=!0;var o=n({props:{show:Boolean},mounted:function(){$(this.$el).modal({dismissible:!1,inDuration:0}),this.$watch("show",(function(t){$(this.$el).modal(t?"open":"close")}),{immediate:!0})}},s,[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"modal-content"},[a("h4",[t._v("Login")]),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"input-field col s12"},[a("input",{attrs:{id:"email",type:"email"}}),t._v(" "),a("label",{attrs:{for:"email"}},[t._v("Email")])])]),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"input-field col s12"},[a("input",{attrs:{id:"password",type:"password"}}),t._v(" "),a("label",{attrs:{for:"password"}},[t._v("Password")])])])])}],!1,null,null,null);o.options.__file="src/create/component/LoginForm.vue";const r=o.exports;var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition-group",{directives:[{name:"show",rawName:"v-show",value:t.ready,expression:"ready"}],staticClass:"mdl-grid",attrs:{name:"card",tag:"section"}},t._l(t.posts,(function(e){return a("div",{key:e,staticClass:"card",attrs:{id:e.key}},[a("div",{staticClass:"card-title white-text pink lighten-1"},[t._v(t._s(e.title))]),t._v(" "),a("div",{staticClass:"card-content"},[t._l(e.body.split("\n"),(function(e){return a("p",[t._v(t._s(e))])})),t._v(" "),a("p",[t._v(t._s(t._f("date-localize")(e.createdAt)))])],2)])})),0)};function c(t){var e=new Date(t);if(isNaN(e.getTime()))return"Invalid date";var a=e.getHours();return e.getFullYear()+"年"+(e.getMonth()+1)+"月"+e.getDate()+"日"+(a>=12?"午後":"午前")+((a+11)%12+1)+"時"+e.getMinutes()+"分 "+"日月火水木金土"[e.getDay()]+"曜日"}l._withStripped=!0;var u=n({props:{posts:Array,ready:Boolean},filters:{"date-localize":c}},l,[],!1,null,null,null);u.options.__file="src/common/component/PostCards.vue";const d=u.exports;var p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("form",{staticClass:"card",attrs:{action:"#",method:"POST"},on:{submit:function(e){return e.preventDefault(),t.$emit("submit",e)},reset:function(e){return t.$emit("reset",e)}}},[a("div",{staticClass:"card-title white-text pink lighten-1"},[t._v(t._s(t.heading))]),t._v(" "),a("div",{staticClass:"card-content"},[a("div",{staticClass:"input-field"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.value.title,expression:"value.title"}],attrs:{id:"title",type:"text",required:""},domProps:{value:t.value.title},on:{input:function(e){e.target.composing||t.$set(t.value,"title",e.target.value)}}}),t._v(" "),a("label",{attrs:{for:"title"}},[t._v("Title")])]),t._v(" "),a("div",{staticClass:"input-field"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.value.body,expression:"value.body"}],staticClass:"materialize-textarea",attrs:{id:"body",required:""},domProps:{value:t.value.body},on:{input:function(e){e.target.composing||t.$set(t.value,"body",e.target.value)}}}),t._v(" "),a("label",{attrs:{for:"body"}},[t._v("Body")])]),t._v(" "),a("div",{staticClass:"input-field"},[a("datetime-local",{staticClass:"validate",attrs:{id:"createdAt",required:""},model:{value:t.value.createdAt,callback:function(e){t.$set(t.value,"createdAt",e)},expression:"value.createdAt"}}),t._v(" "),a("label",{staticClass:"active",attrs:{for:"createdAt"}},[t._v("Created at")])],1)]),t._v(" "),a("div",{staticClass:"card-action"},[t._t("default")],2)])};p._withStripped=!0;var v=function(){var t=this,e=t.$createElement;return(t._self._c||e)("input",{attrs:{type:"text"},domProps:{value:t.value},on:{input:t.input}})};v._withStripped=!0;var m=n({props:{value:String},methods:{input:function(t){var e=t.target.value;moment&&!moment(e,moment.ISO_8601).isValid()&&this.$el.setCustomValidity("Invalid date"),this.$emit("input",e)}}},v,[],!1,null,null,null);m.options.__file="src/create/component/DatetimeLocal.vue";const f=m.exports;var h=n({props:{heading:String,value:Object},components:{"datetime-local":f}},p,[],!1,null,null,null);h.options.__file="src/create/component/PostFormCard.vue";const _=h.exports;moment.locale("ja");var g=new Vue({el:"#app",data:{user:i.getUser(),busy:!1,post:{title:"",body:"",createdAt:""}},methods:{onCreate:function(a){var i=this;i.busy=!0,t.create(this.post.title,this.post.body,this.post.createdAt).then((function(t){return Materialize.toast("The new post was successfully created."),e.publish(t.key,i.post)})).then((function(){i.busy=!1,a.target.reset(),Materialize.toast("The new post was successfully published.")})).catch((function(t){i.busy=!1,console.error(t),Materialize.toast(t.message)}))},onLogin:function(t,e){i.login(t,e).catch((function(t){console.error(t),Materialize.toast(t.message)}))},onLogout:function(){i.logout()},onReset:function(t){this.post.title=this.post.body="",this.post.createdAt=moment().format("YYYY-MM-DDTHH:mm")}},mounted:function(){this.$el.querySelector("form").reset()},components:{"login-form":r,"post-cards":d,"post-form-card":_},filters:{"date-localize":c}});addEventListener("load",(function(){!function(){firebase.initializeApp({apiKey:"AIzaSyB3rU05SgP6XFnQqPgrvCBLSPulxsfpwxI",authDomain:"sns-taka3sh-org-157419.firebaseapp.com",databaseURL:"https://sns-taka3sh-org-157419.firebaseio.com",messagingSenderId:"895779023522"});var a=firebase.auth(),s=firebase.database();i.init(a),e.init(a,"https://sns-taka3sh-org-157419.appspot.com/publish.dev"),t.init(s.ref("posts-stage"))}(),firebase.auth().onAuthStateChanged((function(t){g.user=t&&t.email}))}))})();