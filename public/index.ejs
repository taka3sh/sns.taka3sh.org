<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
  <%- include('_partial/header.ejs') %>

  <main class="mdl-layout__content" id="app">
    <section class="mdl-grid">
      <p class="mdl-cell mdl-cell--12-col">
        こちらは、たかさん支援隊からの連絡などを配信するサイトです。
      </p>
      <button class="mdl-button mdl-js-button mdl-button--raised" :class="{ 'mdl-button--accent': notify }" :disabled="busy" @click="onToggle">
        {{ notify ? '通知オン' : '通知オフ' }}
      </button>
      <template v-if="error === 'messaging/permission-blocked'">
        通知がブロックされています。
      </template>
      <div class="mdl-spinner mdl-js-spinner is-active" v-show="busy"></div>
    </section>

    <sns-posts :posts="posts" :loaded="true"></sns-posts>

    <section class="mdl-grid" v-show="!loaded">
      <div class="loading mdl-card mdl-cell mdl-cell--12-col mdl-shadow--2dp">
        <div class="mdl-card__title">
          <h2 class="mdl-card__title-text">Loading...</h2>
        </div>
        <div class="mdl-card__supporting-text">
          <div class="mdl-spinner mdl-js-spinner is-active"></div>
        </div>
      </div>
    </section>

    <%- include('_partial/footer.ejs') %>
  </main>
</div>

<script type="text/x-template" id="sns-posts">
  <transition-group name="posts" tag="section" class="mdl-grid" v-show="loaded">
    <div v-for="post in posts" class="mdl-card mdl-cell mdl-cell--12-col mdl-shadow--2dp" :key="post">
      <div class="mdl-card__title">
        <h2 class="mdl-card__title-text">{{ post.title }}</h2>
      </div>
      <div class="mdl-card__supporting-text">
        <p v-for="line in post.body.split('\n')">{{ line }}</p>
        <p>{{ post.createdAt | date-localize }}</p>
      </div>
    </div>
  </transition-group>
</script>

<script><%- include('_js/index.js') %></script>